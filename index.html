<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Rights Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen">
    <div id="app" class="min-h-screen flex items-center justify-center p-6"></div>

    <script>
        // In-memory state (no localStorage needed)
        const state = {
            step: 'upload', // upload, processing, review, dashboard
            artist: {
                name: '',
                email: '',
                ownsMasters: null,
                isComposer: null,
                releaseYears: '',
                tracks: []
            },
            uploadedText: ''
        };

        function render() {
            const app = document.getElementById('app');
            
            if (state.step === 'upload') {
                app.innerHTML = renderUpload();
            } else if (state.step === 'processing') {
                app.innerHTML = renderProcessing();
            } else if (state.step === 'review') {
                app.innerHTML = renderReview();
            } else if (state.step === 'dashboard') {
                app.innerHTML = renderDashboard();
            }
        }

        function renderUpload() {
            return `
                <div class="max-w-2xl w-full">
                    <div class="text-center mb-8">
                        <svg class="w-16 h-16 mx-auto mb-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
                        </svg>
                        <h1 class="text-4xl font-bold mb-2 text-gray-900">Music Rights Agent</h1>
                        <p class="text-xl text-gray-600">Upload your tracklist and I'll handle the rest</p>
                    </div>

                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <div 
                            id="dropzone"
                            class="border-3 border-dashed border-gray-300 rounded-xl p-12 text-center hover:border-blue-500 hover:bg-blue-50 transition cursor-pointer"
                            ondrop="handleDrop(event)"
                            ondragover="handleDragOver(event)"
                            ondragleave="handleDragLeave(event)"
                            onclick="document.getElementById('fileInput').click()"
                        >
                            <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            <p class="text-lg font-medium text-gray-700 mb-2">Drop your tracklist or credits file here</p>
                            <p class="text-sm text-gray-500 mb-4">or click to browse</p>
                            <p class="text-xs text-gray-400">Supports .txt, .pdf, .html, images with text</p>
                            <input type="file" id="fileInput" class="hidden" accept=".txt,.pdf,.html,.jpg,.jpeg,.png" onchange="handleFile(event)">
                        </div>

                        <div class="relative my-6">
                            <div class="absolute inset-0 flex items-center">
                                <div class="w-full border-t border-gray-300"></div>
                            </div>
                            <div class="relative flex justify-center text-sm">
                                <span class="px-4 bg-white text-gray-500">or paste your credits</span>
                            </div>
                        </div>

                        <textarea 
                            id="pasteArea"
                            class="w-full p-4 border-2 border-gray-300 rounded-xl focus:border-blue-600 focus:outline-none resize-none"
                            rows="6"
                            placeholder="Paste your tracklist, credits, or metadata here...

Example:
Track 1: Song Title
Written by: Your Name
Produced by: Your Name
Release: 2024"
                            onpaste="setTimeout(() => handlePaste(), 100)"
                        ></textarea>

                        <button 
                            onclick="processManualInput()"
                            class="w-full mt-4 bg-blue-600 text-white py-4 rounded-xl font-semibold text-lg hover:bg-blue-700 transition shadow-lg"
                        >
                            Analyze My Credits
                        </button>
                    </div>

                    <div class="mt-6 text-center text-sm text-gray-500">
                        <p>‚úì Free assessment ‚Ä¢ ‚úì Takes 2 minutes ‚Ä¢ ‚úì EU-focused</p>
                    </div>
                </div>
            `;
        }

        function renderProcessing() {
            return `
                <div class="max-w-2xl w-full bg-white rounded-2xl shadow-xl p-12 text-center">
                    <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-6"></div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Analyzing your credits...</h2>
                    <p class="text-gray-600">Extracting ownership info, roles, and metadata</p>
                </div>
            `;
        }

        function renderReview() {
            const ownsMastersYes = state.artist.ownsMasters === true;
            const ownsMastersNo = state.artist.ownsMasters === false;
            const isComposerYes = state.artist.isComposer === true;
            const isComposerNo = state.artist.isComposer === false;

            return `
                <div class="max-w-3xl w-full bg-white rounded-2xl shadow-xl p-8">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-900 mb-2">Review Extracted Info</h2>
                        <p class="text-gray-600">I've analyzed your credits. Please verify and complete:</p>
                    </div>

                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Artist Name</label>
                            <input 
                                type="text" 
                                id="artistName"
                                value="${state.artist.name}"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-600 focus:outline-none"
                                placeholder="Your artist name"
                            >
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input 
                                type="email" 
                                id="artistEmail"
                                value="${state.artist.email}"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-600 focus:outline-none"
                                placeholder="your@email.com"
                            >
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Do you own the master recordings?</label>
                            <div class="flex gap-3">
                                <button 
                                    onclick="updateField('ownsMasters', true)"
                                    class="flex-1 py-3 px-4 border-2 rounded-lg font-medium transition ${ownsMastersYes ? 'border-blue-600 bg-blue-50 text-blue-700' : 'border-gray-300 hover:border-gray-400'}"
                                >
                                    ‚úì Yes, I own them
                                </button>
                                <button 
                                    onclick="updateField('ownsMasters', false)"
                                    class="flex-1 py-3 px-4 border-2 rounded-lg font-medium transition ${ownsMastersNo ? 'border-blue-600 bg-blue-50 text-blue-700' : 'border-gray-300 hover:border-gray-400'}"
                                >
                                    ‚úó No, label owns
                                </button>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Did you write the music and lyrics?</label>
                            <div class="flex gap-3">
                                <button 
                                    onclick="updateField('isComposer', true)"
                                    class="flex-1 py-3 px-4 border-2 rounded-lg font-medium transition ${isComposerYes ? 'border-blue-600 bg-blue-50 text-blue-700' : 'border-gray-300 hover:border-gray-400'}"
                                >
                                    ‚úì Yes, I wrote it
                                </button>
                                <button 
                                    onclick="updateField('isComposer', false)"
                                    class="flex-1 py-3 px-4 border-2 rounded-lg font-medium transition ${isComposerNo ? 'border-blue-600 bg-blue-50 text-blue-700' : 'border-gray-300 hover:border-gray-400'}"
                                >
                                    ‚úó No, co-written
                                </button>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Release Year(s)</label>
                            <input 
                                type="text" 
                                id="releaseYears"
                                value="${state.artist.releaseYears}"
                                class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-600 focus:outline-none"
                                placeholder="e.g. 2024 or 2023-2024"
                            >
                        </div>

                        ${state.artist.tracks.length > 0 ? `
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="font-medium text-gray-900 mb-2">Detected Tracks:</div>
                                <ul class="text-sm text-gray-700 space-y-1">
                                    ${state.artist.tracks.slice(0, 5).map(t => `<li>‚Ä¢ ${t}</li>`).join('')}
                                    ${state.artist.tracks.length > 5 ? `<li class="text-gray-500">...and ${state.artist.tracks.length - 5} more</li>` : ''}
                                </ul>
                            </div>
                        ` : ''}

                        <button 
                            onclick="finalize()"
                            class="w-full bg-blue-600 text-white py-4 rounded-xl font-semibold text-lg hover:bg-blue-700 transition shadow-lg mt-8"
                        >
                            Continue to Dashboard ‚Üí
                        </button>
                    </div>
                </div>
            `;
        }

        function renderDashboard() {
            const estimatedLoss = state.artist.ownsMasters && state.artist.isComposer ? '‚Ç¨500-2000/year' : '‚Ç¨200-800/year';

            return `
                <div class="max-w-4xl w-full">
                    <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 mb-1">Welcome, ${state.artist.name}</h2>
                                <p class="text-gray-600">${state.artist.email}</p>
                            </div>
                            <button onclick="state.step = 'review'; render();" class="text-blue-600 hover:underline font-medium text-sm">
                                Edit Info
                            </button>
                        </div>

                        <div class="bg-red-50 border-2 border-red-200 rounded-xl p-6 mb-8">
                            <div class="flex items-start gap-4">
                                <svg class="w-8 h-8 text-red-600 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                </svg>
                                <div>
                                    <div class="font-bold text-red-900 text-lg mb-1">You're losing money right now</div>
                                    <div class="text-red-800">
                                        Without proper registration, you could be losing <strong>${estimatedLoss}</strong> per release in unclaimed royalties.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h3 class="text-xl font-bold text-gray-900 mb-4">Your Rights Status</h3>
                        
                        <div class="space-y-3 mb-8">
                            ${renderStatusCard('missing', 'SABAM Writer Registration', 'high', 'Register as writer + publisher with SABAM')}
                            ${renderStatusCard('missing', 'Neighboring Rights', 'high', 'Register with PlayRight for performer royalties')}
                            ${renderStatusCard('missing', 'ISRC Codes', 'medium', 'Generate ISRCs before distribution')}
                            ${renderStatusCard('partial', 'Metadata Complete', 'medium', 'Verify all credits and splits')}
                        </div>

                        <button 
                            onclick="copySabamEmail()"
                            class="w-full bg-blue-600 text-white py-4 rounded-xl font-semibold text-lg hover:bg-blue-700 transition shadow-lg mb-4"
                        >
                            üìß Copy SABAM Registration Email
                        </button>

                        <div class="text-center text-sm text-gray-500">
                            <p>Want me to handle this automatically? <span class="font-medium text-blue-600">Premium automation coming soon</span></p>
                        </div>
                    </div>

                    <button onclick="state.step = 'upload'; state.artist = {name:'',email:'',ownsMasters:null,isComposer:null,releaseYears:'',tracks:[]}; render();" class="text-gray-600 hover:text-gray-900 font-medium">
                        ‚Üê Start Over
                    </button>
                </div>
            `;
        }

        function renderStatusCard(status, label, risk, action) {
            const icon = status === 'missing' ? 
                '<svg class="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>' :
                '<svg class="w-6 h-6 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>';
            
            const riskColor = risk === 'high' ? 'text-red-600' : 'text-yellow-600';
            
            return `
                <div class="border-2 border-gray-200 rounded-xl p-4 hover:border-blue-300 transition">
                    <div class="flex items-start gap-4">
                        ${icon}
                        <div class="flex-1">
                            <div class="font-semibold text-gray-900 text-lg">${label}</div>
                            <div class="text-sm mt-1 font-semibold ${riskColor}">Risk: ${risk.toUpperCase()}</div>
                            <div class="mt-2 text-sm text-gray-700 bg-blue-50 p-3 rounded-lg">
                                <strong>Next step:</strong> ${action}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- File handling ---
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('dropzone').classList.add('border-blue-500', 'bg-blue-50');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('dropzone').classList.remove('border-blue-500', 'bg-blue-50');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('dropzone').classList.remove('border-blue-500', 'bg-blue-50');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function handleFile(e) {
            const file = e.target.files[0];
            if (file) {
                processFile(file);
            }
        }

        function handlePaste() {
            const text = document.getElementById('pasteArea').value;
            if (text.trim()) {
                processText(text);
            }
        }

        function processManualInput() {
            const text = document.getElementById('pasteArea').value.trim();
            if (!text) {
                alert('Please paste your credits or upload a file first');
                return;
            }
            processText(text);
        }

        async function processFile(file) {
            state.step = 'processing';
            render();

            const text = await file.text();
            
            setTimeout(() => {
                processText(text);
            }, 1500); // Simulate processing time
        }

        function processText(text) {
            state.uploadedText = text;
            
            // Simple extraction logic (replace with AI later)
            const lines = text.split('\n');
            
            // Extract artist name
            const artistMatch = text.match(/(?:artist|by|name)[\s:]+([^\n,]+)/i);
            if (artistMatch) state.artist.name = artistMatch[1].trim();
            
            // Extract email
            const emailMatch = text.match(/[\w.-]+@[\w.-]+\.\w+/);
            if (emailMatch) state.artist.email = emailMatch[0];
            
            // Extract year
            const yearMatch = text.match(/(20\d{2}(?:\s*[-‚Äì]\s*20\d{2})?)/);
            if (yearMatch) state.artist.releaseYears = yearMatch[1];
            
            // Detect ownership keywords
            if (/(?:own|produced by|master)/i.test(text)) {
                state.artist.ownsMasters = true;
            }
            if (/(?:written by|composed by|lyrics|composer)/i.test(text)) {
                state.artist.isComposer = true;
            }
            
            // Extract track titles
            state.artist.tracks = lines
                .filter(line => /^(?:\d+[\.\):]|\-|‚Ä¢|track)/i.test(line.trim()))
                .map(line => line.replace(/^(?:\d+[\.\):]|\-|‚Ä¢|track)\s*/i, '').trim())
                .filter(t => t.length > 0 && t.length < 100);
            
            state.step = 'review';
            render();
        }

        function updateField(field, value) {
            state.artist[field] = value;
            render();
        }

        function finalize() {
            state.artist.name = document.getElementById('artistName').value.trim();
            state.artist.email = document.getElementById('artistEmail').value.trim();
            state.artist.releaseYears = document.getElementById('releaseYears').value.trim();
            
            if (!state.artist.name || !state.artist.email) {
                alert('Please fill in your name and email');
                return;
            }
            
            state.step = 'dashboard';
            render();
        }

        function copySabamEmail() {
            const email = `Subject: SABAM Writer & Publisher Registration Request

Dear SABAM,

I am an independent musician based in Belgium and would like to register as both a writer and publisher.

Artist Name: ${state.artist.name}
Email: ${state.artist.email}
Role: Composer, Lyricist, Producer, Performer

I own 100% of my master recordings and compositions for upcoming releases.

Could you please send me the registration forms and next steps?

Thank you,
${state.artist.name}`;

            navigator.clipboard.writeText(email);
            alert('‚úì Email copied! Paste it into your email client and send to info@sabam.be');
        }

        // Start app
        render();
    </script>
</body>
</html>
