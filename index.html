<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Rights Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen p-6">
    <div id="app" class="max-w-4xl mx-auto py-12"></div>
    <div class="fixed bottom-2 right-2">
        <button onclick="clearDB()" class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 text-xs">Clear Data</button>
    </div>
    <script>
        const STORAGE_KEY = "musicRightsAgentDB";
        const STEP_KEY = "wizardStep";
        function saveDB() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(artistDB));
        }
        function loadDB() {
            const data = localStorage.getItem(STORAGE_KEY);
            if (data) {
                try { return JSON.parse(data); } catch (e) {}
            }
            return {
                artist: { name: "", email: "", country: "BE", ownsMasters: null, isComposer: null, releaseYears: "" },
                releases: [], tracks: [], persons: [], contributions: []
            };
        }
        function clearDB() {
            localStorage.removeItem(STORAGE_KEY);
            localStorage.removeItem(STEP_KEY);
            window.location.reload();
        }
        let artistDB = loadDB();

        const questions = [
            { field: 'artistName', question: "What's your artist name?", type: 'text' },
            { field: 'email', question: "What's your email?", type: 'email' },
            { field: 'ownsMasters', question: "Do you own the master recordings?", type: 'boolean', help: "Did you produce and pay for the recordings yourself?" },
            { field: 'isComposer', question: "Did you write the music and lyrics?", type: 'boolean' },
            { field: 'releaseYears', question: "When will you release (or when did you release)?", type: 'text', placeholder: "e.g. 2025, or 2023-2024" }
        ];

        function allQuestionsAnswered() {
            return (
                artistDB.artist.name &&
                artistDB.artist.email &&
                artistDB.artist.ownsMasters !== null &&
                artistDB.artist.isComposer !== null &&
                artistDB.artist.releaseYears
            );
        }

        function getStartStep() {
            if (allQuestionsAnswered()) return questions.length + 1;
            const saved = parseInt(localStorage.getItem(STEP_KEY), 10);
            return Number.isInteger(saved) && saved >= 0 && saved <= questions.length + 1 ? saved : 0;
        }

        const state = {
            step: getStartStep(),
            data: {
                artistName: artistDB.artist.name || "",
                email: artistDB.artist.email || "",
                ownsMasters: artistDB.artist.ownsMasters,
                isComposer: artistDB.artist.isComposer,
                releaseYears: artistDB.artist.releaseYears || ""
            }
        };

        function saveStep() {
            localStorage.setItem(STEP_KEY, state.step);
        }

        function render() {
            const app = document.getElementById('app');
            if (state.step === 0) app.innerHTML = renderWelcome();
            else if (state.step <= questions.length) app.innerHTML = renderQuestion();
            else if (state.step === questions.length + 1) app.innerHTML = renderAssessment();
            else app.innerHTML = renderActions();
        }

        function renderWelcome() {
            return `
                <div class="max-w-2xl mx-auto text-center">
                    <svg class="w-16 h-16 mx-auto mb-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
                    </svg>
                    <h1 class="text-3xl font-bold mb-4 text-gray-900">Music Rights Agent</h1>
                    <p class="text-lg text-gray-600 mb-8">
                        Stop losing money on your music. I'll handle your rights registration automatically.
                    </p>
                    <button onclick="nextStep()" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-medium hover:bg-blue-700 transition">
                        Get Started
                    </button>
                    <div class="mt-8 text-sm text-gray-500">Free assessment • Takes 2 minutes</div>
                </div>
            `;
        }

        function renderQuestion() {
            const q = questions[state.step - 1];
            let val = state.data[q.field];
            if (val === null || val === undefined) val = "";
            return `
                <div class="max-w-xl mx-auto">
                    <div class="mb-6">
                        <div class="flex gap-1 mb-4">
                            ${questions.map((_, i) => `
                                <div class="h-1 flex-1 rounded ${i < state.step - 1 ? 'bg-blue-600' : 'bg-gray-200'}"></div>
                            `).join('')}
                        </div>
                        <div class="text-sm text-gray-500 mb-2">Question ${state.step} of ${questions.length}</div>
                    </div>
                    <div class="bg-white rounded-lg p-6 shadow-sm border">
                        <h2 class="text-xl font-semibold mb-2 text-gray-900">${q.question}</h2>
                        ${q.help ? `<p class="text-sm text-gray-500 mb-4">${q.help}</p>` : ''}
                        ${q.type === 'boolean' ? `
                            <div class="flex gap-3">
                                <button onclick="answer(true)" class="flex-1 py-3 px-4 border-2 border-gray-300 rounded-lg hover:border-blue-600 hover:bg-blue-50 transition"${val===true?" style='background:#e0e7ff;border-color:#2563eb'" : ""}>
                                    Yes
                                </button>
                                <button onclick="answer(false)" class="flex-1 py-3 px-4 border-2 border-gray-300 rounded-lg hover:border-blue-600 hover:bg-blue-50 transition"${val===false?" style='background:#e0e7ff;border-color:#2563eb'" : ""}>
                                    No
                                </button>
                            </div>
                        ` : `
                            <div>
                                <input 
                                    type="${q.type}" 
                                    id="input" 
                                    placeholder="${q.placeholder || ''}"
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-600 focus:outline-none"
                                    value="${val}"
                                    onkeydown="if(event.key==='Enter' && this.value) answer(this.value)"
                                >
                                <button onclick="answerFromInput()" class="mt-3 w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">
                                    Continue
                                </button>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        function renderAssessment() {
            const estimatedLoss = state.data.ownsMasters && state.data.isComposer ? '€500-2000/year' : '€200-800/year';
            return `
                <div class="max-w-3xl mx-auto">
                    <div class="bg-red-50 border-2 border-red-200 rounded-lg p-4 mb-6">
                        <div class="flex items-start gap-3">
                            <svg class="w-6 h-6 text-red-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <div>
                                <div class="font-semibold text-red-900">Potential Revenue Loss</div>
                                <div class="text-red-700 text-sm mt-1">
                                    Without proper registration, you could lose <strong>${estimatedLoss}</strong> per release
                                </div>
                            </div>
                        </div>
                    </div>
                    <h2 class="text-2xl font-bold mb-4 text-gray-900">Your Rights Status</h2>
                    <p class="text-gray-600 mb-6">Based on your answers, here's what needs to be done:</p>
                    <div class="space-y-3">
                        ${renderStatus('missing', 'SABAM Writer Registration', 'high', 'Register as writer + publisher with SABAM before release')}
                        ${renderStatus('missing', 'Neighboring Rights (Performance)', 'high', 'Register with PlayRight (Belgium) for performer royalties')}
                        ${renderStatus('missing', 'ISRC Codes', 'medium', 'Generate ISRCs before uploading to distributor')}
                        ${renderStatus('partial', 'Metadata & Credits', 'medium', 'Prepare complete metadata (roles, splits, contributors)')}
                    </div>
                    <div class="mt-8 flex gap-3">
                        <button onclick="nextStep()" class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">
                            Start Fixing This
                        </button>
                        <button onclick="restartWizard()" class="px-6 py-3 border-2 border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition">
                            Start Over
                        </button>
                    </div>
                </div>
            `;
        }

        function renderStatus(status, label, risk, action) {
            const icon = status === 'missing' ? 
                '<svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>' :
                '<svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            const riskColor = risk === 'high' ? 'text-red-600' : 'text-yellow-600';
            return `
                <div class="border rounded-lg p-4 bg-white">
                    <div class="flex items-start gap-3">
                        ${icon}
                        <div class="flex-1">
                            <div class="font-medium text-gray-900">${label}</div>
                            <div class="text-sm mt-1 font-semibold ${riskColor}">Money risk: ${risk.toUpperCase()}</div>
                            <div class="mt-2 text-sm text-gray-600 bg-blue-50 p-2 rounded">
                                <strong>Action:</strong> ${action}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderActions() {
            const sabamEmail = `Subject: SABAM Writer & Publisher Registration Request

Dear SABAM,

I am an independent musician based in Belgium and would like to register as both a writer and publisher.

Artist Name: ${state.data.artistName}
Email: ${state.data.email}
Role: Composer, Lyricist, Producer, Performer

I own 100% of my master recordings and compositions for upcoming releases.

Could you please send me the registration forms and next steps?

Thank you,
${state.data.artistName}`;
            return `
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-2xl font-bold mb-2 text-gray-900">Action Dashboard</h2>
                    <p class="text-gray-600 mb-6">Complete these in order. I've prepared everything for you.</p>
                    <div class="bg-white rounded-lg p-6 border">
                        <div class="flex items-start gap-3 mb-4 bg-blue-50 p-3 rounded">
                            <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <div class="text-sm text-blue-900">
                                <strong>Priority: HIGH</strong> — Do this first. Takes 5 minutes.
                            </div>
                        </div>
                        <h3 class="font-semibold text-lg mb-3 text-gray-900">Step 1: Email SABAM</h3>
                        <p class="text-sm text-gray-600 mb-4">
                            Copy this email and send it to <strong>info@sabam.be</strong>
                        </p>
                        <div class="bg-gray-50 p-4 rounded border mb-4 font-mono text-sm whitespace-pre-wrap overflow-x-auto">${sabamEmail}</div>
                        <button onclick="copyEmail()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">
                            Copy Email & Instructions
                        </button>
                        <div class="mt-4 text-sm text-gray-600 bg-yellow-50 p-3 rounded border border-yellow-200">
                            <strong>What happens next:</strong> SABAM will send you registration forms (1-2 days). Fill them out and return. You'll be registered within 2 weeks.
                        </div>
                    </div>
                    <div class="mt-6">
                        <button onclick="restartWizard()" class="text-gray-600 hover:text-gray-900 font-medium">
                            ← Back to Start
                        </button>
                    </div>
                </div>
            `;
        }

        function answer(value) {
            const q = questions[state.step - 1];
            state.data[q.field] = q.type === "boolean" ? (value === true || value === "true") : value;
            if (q.field === "artistName") artistDB.artist.name = state.data.artistName;
            else if (q.field === "email") artistDB.artist.email = state.data.email;
            else if (q.field === "ownsMasters") artistDB.artist.ownsMasters = state.data.ownsMasters;
            else if (q.field === "isComposer") artistDB.artist.isComposer = state.data.isComposer;
            else if (q.field === "releaseYears") artistDB.artist.releaseYears = state.data.releaseYears;
            saveDB();
            nextStep();
        }

        function answerFromInput() {
            const input = document.getElementById('input');
            if (input && input.value) answer(input.value);
        }

        function nextStep() {
            state.step++;
            saveStep();
            render();
        }

        function saveStep() {
            localStorage.setItem(STEP_KEY, state.step);
        }

        function restartWizard() {
            state.step = 1;
            saveStep();
            render();
        }

        function copyEmail() {
            const sabamEmail = `Subject: SABAM Writer & Publisher Registration Request

Dear SABAM,

I am an independent musician based in Belgium and would like to register as both a writer and publisher.

Artist Name: ${state.data.artistName}
Email: ${state.data.email}
Role: Composer, Lyricist, Producer, Performer

I own 100% of my master recordings and compositions for upcoming releases.

Could you please send me the registration forms and next steps?

Thank you,
${state.data.artistName}`;
            navigator.clipboard.writeText(sabamEmail);
            alert('Email copied! Now paste it into your email client and send to info@sabam.be');
        }

        render();
    </script>
</body>
</html>
